#include "map.h"
#include <stdio.h>

int g_map[MAP_H][MAP_W] = {
  {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
  {1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,1,0,0,0,1},
  {1,0,1,1,1,0,1,0,0,0,0,0,1,0,0,0,1,1,1,1,0,1},
  {1,0,0,0,0,0,1,1,1,1,0,0,1,1,0,0,0,0,1,0,0,1},
  {1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,0,1},
  {1,0,0,1,0,1,0,1,0,0,0,1,1,1,1,1,0,0,1,0,0,1},
  {1,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1},
  {1,0,0,0,0,1,1,1,1,0,0,1,0,0,0,0,1,0,0,1,0,1},
  {1,0,0,1,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,1,1,1},
  {1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1},
  {1,1,1,1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,1,0,0,1},
  {1,0,0,1,0,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,0,1},
  {1,0,0,0,0,1,1,1,1,0,0,0,1,0,0,1,0,0,1,1,1,1},
  {1,0,0,1,0,0,1,0,0,0,0,1,1,1,0,1,1,0,0,0,0,1},
  {1,1,0,1,1,0,0,0,0,1,1,1,0,0,0,1,0,0,0,1,0,1},
  {1,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,1,1,1,1,1},
  {1,0,1,1,0,0,0,1,0,0,0,1,1,0,0,0,0,0,0,0,0,1},
  {1,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,0,0,0,0,0,1},
  {1,1,0,1,0,0,1,0,1,0,0,1,1,1,0,1,0,1,1,1,0,1},
  {1,0,0,1,0,0,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1},
  {1,0,0,1,1,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,1},
  {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
};

int marz_naghshe(int x, int y)
{
    return (x >= 0 && x < MAP_W && y >= 0 && y < MAP_H);
}

void edit_ba_mouse(void)
{
    Vector2 m = GetMousePosition();
    int mapX = (int)(m.x / TILE_SIZE);
    int mapY = (int)(m.y / TILE_SIZE);

    if (!marz_naghshe(mapX, mapY)) return;

    if (mapX == 0 || mapY == 0 || mapX == MAP_W - 1 || mapY == MAP_H - 1)
        return;

    if (IsMouseButtonDown(MOUSE_LEFT_BUTTON)) 
        g_map[mapY][mapX] = 1;

    if (IsMouseButtonDown(MOUSE_RIGHT_BUTTON))
        g_map[mapY][mapX] = 0;

}

void save_map(const char *filename)
{
    FILE *f = fopen(filename, "w");
    if (!f) return;

    for (int y = 0; y < MAP_H; y++)
    {
        for (int x = 0; x < MAP_W; x++)
            fprintf(f, "%d ", g_map[y][x]);
        fprintf(f, "\n");
    }

    fclose(f);
}

void load_map(const char *filename)
{
    FILE *f = fopen(filename, "r");
    if (!f) return;

    for (int y = 0; y < MAP_H; y++)
        for (int x = 0; x < MAP_W; x++)
            fscanf(f, "%d", &g_map[y][x]);

    fclose(f);
}